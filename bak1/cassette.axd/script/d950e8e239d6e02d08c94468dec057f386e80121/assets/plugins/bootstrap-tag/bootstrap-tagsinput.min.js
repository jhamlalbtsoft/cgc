!function(n){"use strict";function i(t,i){this.itemsArray=[],this.$element=n(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=i&&i.itemValue,this.$container=n('<div class="bootstrap-tagsinput"><\/div>'),this.$input=n('<input size="1" type="text" />').appendTo(this.$container),this.$element.after(this.$container),this.build(i)}function r(n,t){if("function"!=typeof n[t]){var i=n[t];n[t]=function(n){return n[i]}}}function o(n,t){if("function"!=typeof n[t]){var i=n[t];n[t]=function(){return i}}}function t(n){return n?e.text(n).html():""}function u(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||"0"==n.selectionStart)&&(t=n.selectionStart),t}var f={tagClass:function(){return"label label-info"},itemValue:function(n){return n?n.toString():n},itemText:function(n){return this.itemValue(n)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(n,t){t.hide().fadeIn()}},e;i.prototype={constructor:i,add:function(i,r){var u=this,f,e,a,o,s;if(!(u.options.maxTags&&u.itemsArray.length>=u.options.maxTags||i!==!1&&!i)){if("object"==typeof i&&!u.objectItems)throw"Can't add objects when itemValue option is not set";if(!i.toString().match(/^\s*$/)){if((u.isSelect&&!u.multiple&&u.itemsArray.length>0&&u.remove(u.itemsArray[0]),"string"==typeof i&&"INPUT"===this.$element[0].tagName)&&(f=i.split(","),f.length>1)){for(e=0;e<f.length;e++)this.add(f[e],!0);return r||u.pushVal(),void 0}var h=u.options.itemValue(i),c=u.options.itemText(i),v=u.options.tagClass(i),l=n.grep(u.itemsArray,function(n){return u.options.itemValue(n)===h})[0];if(l){if(u.options.onTagExists){a=n(".tag",u.$container).filter(function(){return n(this).data("item")===l});u.options.onTagExists(i,a)}}else u.itemsArray.push(i),o=n('<span class="tag '+t(v)+'">'+t(c)+'<span data-role="remove"><\/span><\/span>'),(o.data("item",i),u.findInputWrapper().before(o),o.after(" "),u.isSelect&&!n('option[value="'+escape(h)+'"]',u.$element)[0])&&(s=n("<option selected>"+t(c)+"<\/option>"),s.data("item",i),s.attr("value",h),u.$element.append(s)),r||u.pushVal(),u.options.maxTags===u.itemsArray.length&&u.$container.addClass("bootstrap-tagsinput-max"),u.$element.trigger(n.Event("itemAdded",{item:i}))}}},remove:function(t,i){var r=this;r.objectItems&&(t="object"==typeof t?n.grep(r.itemsArray,function(n){return r.options.itemValue(n)==r.options.itemValue(t)})[0]:n.grep(r.itemsArray,function(n){return r.options.itemValue(n)==t})[0]),t&&(n(".tag",r.$container).filter(function(){return n(this).data("item")===t}).remove(),n("option",r.$element).filter(function(){return n(this).data("item")===t}).remove(),r.itemsArray.splice(r.itemsArray.indexOf(t),1)),i||r.pushVal(),r.options.maxTags>r.itemsArray.length&&r.$container.removeClass("bootstrap-tagsinput-max"),r.$element.trigger(n.Event("itemRemoved",{item:t}))},removeAll:function(){var t=this;for(n(".tag",t.$container).remove(),n("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal(),t.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var i=this;n(".tag",i.$container).each(function(){var r=n(this),u=r.data("item"),e=i.options.itemValue(u),o=i.options.itemText(u),s=i.options.tagClass(u),f;(r.attr("class",null),r.addClass("tag "+t(s)),r.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=t(o),i.isSelect)&&(f=n("option",i.$element).filter(function(){return n(this).data("item")===u}),f.attr("value",e))})},items:function(){return this.itemsArray},pushVal:function(){var t=this,i=n.map(t.items(),function(n){return t.options.itemValue(n).toString()});t.$element.val(i,!0).trigger("change")},build:function(t){var i=this,e;i.options=n.extend({},f,t),e=i.options.typeahead||{},i.objectItems&&(i.options.freeInput=!1),r(i.options,"itemValue"),r(i.options,"itemText"),r(i.options,"tagClass"),i.options.source&&(e.source=i.options.source),e.source&&n.fn.typeahead&&(o(e,"source"),i.$input.typeahead({source:function(t,r){function f(n){for(var f,u=[],t=0;t<n.length;t++)f=i.options.itemText(n[t]),o[f]=n[t],u.push(f);r(u)}this.map={};var o=this.map,u=e.source(t);n.isFunction(u.success)?u.success(f):n.when(u).then(f)},updater:function(n){i.add(this.map[n])},matcher:function(n){return-1!==n.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(n){return n.sort()},highlighter:function(n){var t=new RegExp("("+this.query+")","gi");return n.replace(t,"<strong>$1<\/strong>")}})),i.$container.on("click",n.proxy(function(){i.$input.focus()},i)),i.$container.on("keydown","input",n.proxy(function(t){var r=n(t.target),f=i.findInputWrapper(),e,o,s,h;switch(t.which){case 8:0===u(r[0])&&(e=f.prev(),e&&i.remove(e.data("item")));break;case 46:0===u(r[0])&&(o=f.next(),o&&i.remove(o.data("item")));break;case 37:s=f.prev(),0===r.val().length&&s[0]&&(s.before(f),r.focus());break;case 39:h=f.next(),0===r.val().length&&h[0]&&(h.after(f),r.focus());break;default:i.options.freeInput&&i.options.confirmKeys.indexOf(t.which)>=0&&(i.add(r.val()),r.val(""),t.preventDefault())}r.attr("size",Math.max(1,r.val().length))},i)),i.$container.on("click","[data-role=remove]",n.proxy(function(t){i.remove(n(t.target).closest(".tag").data("item"))},i)),i.options.itemValue===f.itemValue&&("INPUT"===i.$element[0].tagName?i.add(i.$element.val()):n("option",i.$element).each(function(){i.add(n(this).attr("value"),!0)}))},destroy:function(){var n=this;n.$container.off("keypress","input"),n.$container.off("click","[role=remove]"),n.$container.remove(),n.$element.removeData("tagsinput"),n.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],i=this.$container[0];t&&t.parentNode!==i;)t=t.parentNode;return n(t)}},n.fn.tagsinput=function(t,r){var u=[];return this.each(function(){var f=n(this).data("tagsinput"),e;f?(e=f[t](r),void 0!==e&&u.push(e)):(f=new i(this,t),n(this).data("tagsinput",f),u.push(f),"SELECT"===this.tagName&&n("option",n(this)).attr("selected","selected"),n(this).val(n(this).val()))}),"string"==typeof t?u.length>1?u:u[0]:u},n.fn.tagsinput.Constructor=i,e=n("<div />"),n(function(){n("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery)